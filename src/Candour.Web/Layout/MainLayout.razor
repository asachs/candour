@inherits LayoutComponentBase
@inject IDialogService DialogService

<MudThemeProvider Theme="_theme" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Elevation="1" Color="Color.Primary">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit"
                       Edge="Edge.Start" OnClick="ToggleDrawer" Class="d-md-none" />
        <MudText Typo="Typo.h6" Class="ml-3">Candour</MudText>
        <MudSpacer />
        <div class="d-none d-md-flex align-center">
            <MudButton Href="/" Color="Color.Inherit" Variant="Variant.Text">Home</MudButton>
            <AuthorizeView>
                <Authorized>
                    <MudButton Href="/admin" Color="Color.Inherit" Variant="Variant.Text">Admin</MudButton>
                    <MudText Typo="Typo.body2" Class="mx-2 d-flex align-center" Style="opacity:0.85">@context.User.FindFirst("name")?.Value</MudText>
                    <MudButton Href="authentication/logout" Color="Color.Inherit" Variant="Variant.Text">Logout</MudButton>
                </Authorized>
                <NotAuthorized>
                    <MudButton Href="authentication/login" Color="Color.Inherit" Variant="Variant.Text">Login</MudButton>
                </NotAuthorized>
            </AuthorizeView>
        </div>
    </MudAppBar>
    <MudDrawer @bind-Open="_drawerOpen" Elevation="1"
               Variant="DrawerVariant.Temporary"
               ClipMode="DrawerClipMode.Never">
        <MudNavMenu>
            <MudNavLink Href="/" Icon="@Icons.Material.Filled.Home" OnClick="CloseDrawer">Home</MudNavLink>
            <AuthorizeView>
                <Authorized>
                    <MudNavLink Href="/admin" Icon="@Icons.Material.Filled.AdminPanelSettings" OnClick="CloseDrawer">Admin</MudNavLink>
                    <MudDivider Class="my-2" />
                    <MudText Typo="Typo.caption" Class="px-4 py-1" Style="opacity:0.7">@context.User.FindFirst("name")?.Value</MudText>
                    <MudNavLink Href="authentication/logout" Icon="@Icons.Material.Filled.Logout">Logout</MudNavLink>
                </Authorized>
                <NotAuthorized>
                    <MudNavLink Href="authentication/login" Icon="@Icons.Material.Filled.Login">Login</MudNavLink>
                </NotAuthorized>
            </AuthorizeView>
        </MudNavMenu>
    </MudDrawer>
    <MudMainContent Class="pt-20 pa-4 pa-md-6">
        @Body
    </MudMainContent>
</MudLayout>

@code {
    private bool _drawerOpen;
    private void ToggleDrawer() => _drawerOpen = !_drawerOpen;
    private void CloseDrawer() => _drawerOpen = false;

    private readonly MudTheme _theme = new()
    {
        PaletteLight = new PaletteLight()
        {
            Primary = "#00695c",
            Secondary = "#37474f",
            AppbarBackground = "#00695c",
            Surface = "#ffffff",
            Background = "#fafafa",
            TextPrimary = "#212121",
            TextSecondary = "#616161",
        }
    };
}
